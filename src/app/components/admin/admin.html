<div class="admin-page">
  <header class="admin-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo">
          <img src="assets/church.ico" alt="Church Manager Logo" />
          <span class="logo-text">
            <span class="church">CHURCH</span> <span class="manager">MANAGER</span>
          </span>
        </div>
        <span class="admin-badge">ADMINISTRADOR</span>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar">
            <span>{{ userName.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="user-details">
            <span class="user-name">{{ userName }}</span>
            <span class="user-email">{{ userEmail }}</span>
          </div>
        </div>
        <button class="btn-logout" (click)="onLogout()">
          <span>Sair</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="admin-content">
    <div class="container">
      <!-- Welcome Section -->
      <section class="welcome-section">
        <h1 class="page-title">Painel de Administra√ß√£o üõ°Ô∏è</h1>
        <p class="page-subtitle">Gerencie todos os eventos da igreja</p>
      </section>

      <!-- Events Section -->
      <section class="events-section">
        <div class="section-header">
          <h2 class="section-title">Todos os Eventos</h2>
          <div class="section-actions">
            <button class="btn-create" (click)="openCreateModal()">
              <span>‚ûï Criar Novo Evento</span>
            </button>
          </div>
        </div>

        <!-- Loading State -->
        @if (isLoading) {
        <div class="loading-container">
          <div class="loading-spinner-large"></div>
          <p>Carregando eventos...</p>
        </div>
        }

        <!-- Error State -->
        @if (errorMessage && !isLoading) {
        <div class="error-container">
          <div class="error-icon">‚ö†Ô∏è</div>
          <p class="error-text">{{ errorMessage }}</p>
          <button class="btn-retry" (click)="loadAllEvents()">Tentar Novamente</button>
        </div>
        }

        <!-- Empty State -->
        @if (!isLoading && !errorMessage && events.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">üìÖ</div>
          <h3 class="empty-title">Nenhum evento cadastrado</h3>
          <p class="empty-text">Clique em "Criar Novo Evento" para adicionar o primeiro evento.</p>
        </div>
        }

        <!-- Events Grid -->
        @if (!isLoading && !errorMessage && events.length > 0) {
        <div class="events-grid">
          @for (event of events; track event.id) {
          <div class="event-card">
            <div class="event-header">
              <div class="event-date-badge">
                <span class="day">{{ formatDate(event.date).split(' ')[0] }}</span>
                <span class="month">{{ formatDate(event.date).split(' ')[2] }}</span>
              </div>
              <div class="event-status" [ngClass]="getEventStatusClass(event.status)">
                {{ getEventStatusText(event.status) }}
              </div>
            </div>

            <div class="event-body">
              <h3 class="event-title">{{ event.title }}</h3>
              <p class="event-description">{{ event.description }}</p>

              <div class="event-details">
                <div class="event-detail">
                  <span class="detail-icon">üìç</span>
                  <span class="detail-text">{{ event.location }}</span>
                </div>
                <div class="event-detail">
                  <span class="detail-icon">üïê</span>
                  <span class="detail-text">{{ formatTime(event.date) }}</span>
                </div>
                <div class="event-detail">
                  <span class="detail-icon">üë•</span>
                  <span class="detail-text">{{ event.participants }} participantes</span>
                </div>
              </div>
            </div>

            <div class="event-footer">
              <button class="btn-event-edit" (click)="openEditModal(event)">‚úèÔ∏è Editar</button>
              <button class="btn-event-delete" (click)="openDeleteConfirm(event)">üóëÔ∏è Excluir</button>
            </div>
          </div>
          }
        </div>
        }
      </section>

    </div>
  </main>

  <!-- Modal Criar Evento -->
  @if (showCreateModal) {
  <div class="modal-overlay" (click)="closeCreateModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">‚ûï Criar Novo Evento</h2>
        <button class="btn-close-modal" (click)="closeCreateModal()">‚úï</button>
      </div>

      <form [formGroup]="createEventForm" (ngSubmit)="onSubmitCreate()" class="modal-body">
        <!-- caso de sucesso -->
        @if (successMessage) {
        <div class="success-message">
          ‚úÖ {{ successMessage }}
        </div>
        }

        <!-- caso de erro -->
        @if (errorMessage) {
        <div class="error-message">
          ‚ùå {{ errorMessage }}
        </div>
        }

        <!-- Nome do Evento -->
        <div class="form-group">
          <label for="name" class="form-label">Nome do Evento *</label>
          <input
            type="text"
            id="name"
            formControlName="name"
            class="form-input"
            placeholder="Ex: Culto Dominical"
            [class.input-error]="name?.invalid && name?.touched"
          />
          @if (name?.invalid && name?.touched) {
          <span class="error-text">
            @if (name?.errors?.['required']) { Nome √© obrigat√≥rio }
            @if (name?.errors?.['minlength']) { Nome deve ter no m√≠nimo 3 caracteres }
          </span>
          }
        </div>

        <!-- Descri√ß√£o -->
        <div class="form-group">
          <label for="description" class="form-label">Descri√ß√£o *</label>
          <textarea
            id="description"
            formControlName="description"
            class="form-textarea"
            placeholder="Descreva o evento..."
            rows="3"
            [class.input-error]="description?.invalid && description?.touched"
          ></textarea>
          @if (description?.invalid && description?.touched) {
          <span class="error-text">
            @if (description?.errors?.['required']) { Descri√ß√£o √© obrigat√≥ria }
            @if (description?.errors?.['minlength']) { Descri√ß√£o deve ter no m√≠nimo 10 caracteres }
          </span>
          }
        </div>

        <!-- Data/Hora In√≠cio -->
        <div class="form-group">
          <label for="startDatetime" class="form-label">Data/Hora de In√≠cio *</label>
          <input
            type="datetime-local"
            id="startDatetime"
            formControlName="startDatetime"
            class="form-input"
            [class.input-error]="startDatetime?.invalid && startDatetime?.touched"
          />
          @if (startDatetime?.invalid && startDatetime?.touched) {
          <span class="error-text">Data/hora de in√≠cio √© obrigat√≥ria</span>
          }
        </div>

        <!-- Data/Hora Fim -->
        <div class="form-group">
          <label for="endDatetime" class="form-label">Data/Hora de T√©rmino *</label>
          <input
            type="datetime-local"
            id="endDatetime"
            formControlName="endDatetime"
            class="form-input"
            [class.input-error]="endDatetime?.invalid && endDatetime?.touched"
          />
          @if (endDatetime?.invalid && endDatetime?.touched) {
          <span class="error-text">Data/hora de t√©rmino √© obrigat√≥ria</span>
          }
        </div>

        <!-- Local -->
        <div class="form-group">
          <label for="location" class="form-label">Local *</label>
          <input
            type="text"
            id="location"
            formControlName="location"
            class="form-input"
            placeholder="Ex: Igreja Central"
            [class.input-error]="location?.invalid && location?.touched"
          />
          @if (location?.invalid && location?.touched) {
          <span class="error-text">Local √© obrigat√≥rio</span>
          }
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn-cancel"
            (click)="closeCreateModal()"
            [disabled]="isSubmitting"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn-submit"
            [disabled]="isSubmitting || createEventForm.invalid"
          >
            @if (isSubmitting) {
              <span>Criando...</span>
            } @else {
              <span>Criar Evento</span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Modal Editar Evento -->
  @if (showEditModal) {
  <div class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">‚úèÔ∏è Editar Evento</h2>
        <button class="btn-close-modal" (click)="closeEditModal()">‚úï</button>
      </div>

      <form [formGroup]="editEventForm" (ngSubmit)="onSubmitEdit()" class="modal-body">
        <!-- caso de sucesso -->
        @if (successMessage) {
        <div class="success-message">
          ‚úÖ {{ successMessage }}
        </div>
        }

        <!-- caso de erro -->
        @if (errorMessage) {
        <div class="error-message">
          ‚ùå {{ errorMessage }}
        </div>
        }

        <!-- Nome do Evento -->
        <div class="form-group">
          <label for="editName" class="form-label">Nome do Evento *</label>
          <input
            type="text"
            id="editName"
            formControlName="name"
            class="form-input"
            placeholder="Ex: Culto Dominical"
            [class.input-error]="editName?.invalid && editName?.touched"
          />
          @if (editName?.invalid && editName?.touched) {
          <span class="error-text">
            @if (editName?.errors?.['required']) { Nome √© obrigat√≥rio }
            @if (editName?.errors?.['minlength']) { Nome deve ter no m√≠nimo 3 caracteres }
          </span>
          }
        </div>

        <!-- Descri√ß√£o -->
        <div class="form-group">
          <label for="editDescription" class="form-label">Descri√ß√£o *</label>
          <textarea
            id="editDescription"
            formControlName="description"
            class="form-textarea"
            placeholder="Descreva o evento..."
            rows="3"
            [class.input-error]="editDescription?.invalid && editDescription?.touched"
          ></textarea>
          @if (editDescription?.invalid && editDescription?.touched) {
          <span class="error-text">
            @if (editDescription?.errors?.['required']) { Descri√ß√£o √© obrigat√≥ria }
            @if (editDescription?.errors?.['minlength']) { Descri√ß√£o deve ter no m√≠nimo 10 caracteres }
          </span>
          }
        </div>

        <!-- Data/Hora In√≠cio -->
        <div class="form-group">
          <label for="editStartDatetime" class="form-label">Data/Hora de In√≠cio *</label>
          <input
            type="datetime-local"
            id="editStartDatetime"
            formControlName="startDatetime"
            class="form-input"
            [class.input-error]="editStartDatetime?.invalid && editStartDatetime?.touched"
          />
          @if (editStartDatetime?.invalid && editStartDatetime?.touched) {
          <span class="error-text">Data/hora de in√≠cio √© obrigat√≥ria</span>
          }
        </div>

        <!-- Data/Hora Fim -->
        <div class="form-group">
          <label for="editEndDatetime" class="form-label">Data/Hora de T√©rmino *</label>
          <input
            type="datetime-local"
            id="editEndDatetime"
            formControlName="endDatetime"
            class="form-input"
            [class.input-error]="editEndDatetime?.invalid && editEndDatetime?.touched"
          />
          @if (editEndDatetime?.invalid && editEndDatetime?.touched) {
          <span class="error-text">Data/hora de t√©rmino √© obrigat√≥ria</span>
          }
        </div>

        <!-- Local -->
        <div class="form-group">
          <label for="editLocation" class="form-label">Local *</label>
          <input
            type="text"
            id="editLocation"
            formControlName="location"
            class="form-input"
            placeholder="Ex: Igreja Central"
            [class.input-error]="editLocation?.invalid && editLocation?.touched"
          />
          @if (editLocation?.invalid && editLocation?.touched) {
          <span class="error-text">Local √© obrigat√≥rio</span>
          }
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn-cancel"
            (click)="closeEditModal()"
            [disabled]="isSubmitting"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn-submit"
            [disabled]="isSubmitting || editEventForm.invalid"
          >
            @if (isSubmitting) {
              <span>Atualizando...</span>
            } @else {
              <span>Atualizar Evento</span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Modal Confirmar Exclus√£o -->
  @if (showDeleteConfirm) {
  <div class="modal-overlay" (click)="closeDeleteConfirm()">
    <div class="modal-container modal-small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">üóëÔ∏è Confirmar Exclus√£o</h2>
        <button class="btn-close-modal" (click)="closeDeleteConfirm()">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- caso de erro -->
        @if (errorMessage) {
        <div class="error-message">
          ‚ùå {{ errorMessage }}
        </div>
        }

        <p class="delete-message">
          Tem certeza que deseja excluir o evento <strong>{{ eventToDelete?.title }}</strong>?
        </p>
        <p class="delete-warning">
          ‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita.
        </p>

        <div class="modal-footer">
          <button
            type="button"
            class="btn-cancel"
            (click)="closeDeleteConfirm()"
            [disabled]="isSubmitting"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn-delete-confirm"
            (click)="confirmDelete()"
            [disabled]="isSubmitting"
          >
            @if (isSubmitting) {
              <span>Excluindo...</span>
            } @else {
              <span>Sim, Excluir</span>
            }
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>
